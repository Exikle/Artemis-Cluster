# yaml-language-server: $schema=https://kubernetes-schemas.pages.dev/external-secrets.io/pushsecret_v1alpha1.json
apiVersion: external-secrets.io/v1alpha1
kind: PushSecret
metadata:
  name: dcunha-io-tls
spec:
  secretStoreRefs:
    - name: bitwarden-clusterstore
      kind: ClusterSecretStore
  selector:
    secret:
      name: dcunha-io-tls
  template:
    engineVersion: v2
    data:
      dcunha-io-tls: |
        {
          "crt": "{{ index . "tls.crt" | b64enc }}",
          "key": "{{ index . "tls.key" | b64enc }}"
        }
  data:
    - match:
        secretKey: &key tls.crt
        remoteRef:
          remoteKey: ${BW_DCUNHAIO_KEY}
          property: *key
    - match:
        secretKey: &key tls.key
        remoteRef:
          remoteKey: ${BW_DCUNHAIO_KEY}
          property: *key
# Found someones on github https://github.com/larivierec/home-cluster/blob/b41f314ca9a463a93d22173af9067892597cfa32/kubernetes/main/apps/cert-manager/cert-manager/issuers/push-cert.yaml#L3
# ---
# apiVersion: external-secrets.io/v1alpha1
# kind: PushSecret
# metadata:
#   name: prod-cert
#   namespace: cert-manager
# spec:
#   deletionPolicy: Delete
#   refreshInterval: 15m
#   secretStoreRefs:
#     - name: bitwarden-secrets-manager-sdk
#       kind: ClusterSecretStore
#   selector:
#     secret:
#       name: wildcard-cert-tls
#   template:
#     engineVersion: v2
#     data:
#       cert: |
#         {
#           "crt": "{{ index . "tls.crt" | b64enc }}",
#           "key": "{{ index . "tls.key" | b64enc }}"
#         }
#   data:
#     - match:
#         secretKey: cert
#         remoteRef:
#           remoteKey: garb_prod_cert
#           property: cert