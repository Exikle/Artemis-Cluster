# yaml-language-server: $schema=https://www.talos.dev/v1.7/schemas/v1alpha1_config.schema.json
version: v1alpha1
debug: false
# persist: true
machine:
    type: worker
    token: ENC[AES256_GCM,data:KHWVxMFhcqfQ/u1xqfIrcvHFXe1oXAs=,iv:JvAeUlTIjtGv1GF4UroUHzDQCtJvy0ysXMi1JnEnuVs=,tag:3/IZBWrUXCMeI8LPDMrqng==,type:str]
    ca:
        crt: ENC[AES256_GCM,data:GLZeXyICJ9/NtRfqunH9qepOzs6edrXh0sRQvQ3DkhvGM7nQ3fLxqH0gOn4M1SDrEsZXA8rkNEgSzJv5Bah9fthMRPlAaktEpZ9+6VQ6OoBw4pLaJC1kmFBO+dXh3Hllq2y2IH7+auXGKNAxhXDeCz0Gh6zAJorLX5xBwConCBmPe5pHWZd7GT/Z30TXVayefHN4+rT0ojaf/pxlyQGqglRD4bVpjbX3bH3g+Ys3nPtWghptzd7bkshrDl0yCUF6y96HD/K2b82YnQ9qJe/lSz4O7UK/sNk2lwZmlJSkY3O49j0RoJHkUhrPOAbRf6Af1c9nOegJUQwYus9WkE7duJLwRRwEDtLRoUSVVi+4Xj3uZrK2b+r/wkHS4iAnXtsqdKQNxeXyU2OaXQaPQ24QTQT8duGbRIRmBZnxbXCbUlS1SfLZIQnldVvYErwdOPvuDzG4ZrFZB2Sae4Sll5vP+guZ9chP0t/nc9vFc9k7EbTGeomgUKHn4Y25vQrsh6DIbyPkGKTgkoddNhrHxbTZSw+UWwFlmOO/9cHekRj2UsioYOPTyFxSdD0ot3bBZ4vEysf6nGX6z/j1kpkdn4+uEJvW3kTvT8IBFw+hpV7EwtcNmZ0utW/JkhnAttlftWdlpaNjsc4X7vHZA7m+hdgS711fw4CMA2CDfnZjPIu29hORwNLEdKgKMAj3QPwf6RNEMnaAiK16AKEGUOUBYltLD7uLadNP4MP4mzn3Hai51+iVgy3mkoxWydoCnuMrSR57XJDaauos1tsNvm6TVvvgMQ7xsoA/DcVLWj8udlFfWVyMd2ZbnzLPCEHgDJNvnq9q8QOyAqMOeaNMN+VHpheQSE/AL25beZJdSANVa/5IldnX6S1o,iv:HEX0VqQzMxXZCEugW5kInrUeFezCQ/LLLNPIxETZJcY=,tag:un+hzB9qLCagK+wrePEP/Q==,type:str]
        key: ""
    certSANs:
        - 127.0.0.1
        - 10.10.99.99
    kubelet:
        image: ghcr.io/siderolabs/kubelet:v1.30.0
        defaultRuntimeSeccompProfileEnabled: true
        disableManifestsDirectory: true
        extraMounts:
            - destination: /var/local/openebs
              type: bind
              source: /var/local/openebs
              options:
                - bind
                - rshared
                - rw
        nodeIP:
            validSubnets:
                - 10.10.99.0/24
    network:
        hostname: talos-w-01
        interfaces:
            - interface: eth0
              dhcp: true
    install:
        disk: /dev/sda
        extraKernelArgs:
            - mitigations=off
            - net.ifnames=0
            - -lockdown lockdown=integrity
            # systemExtensions:
            #     officialExtensions:
            #     - siderolabs/iscsi-tools
            #     - siderolabs/zfs
        image: factory.talos.dev/installer/dc7b152cb3ea99b821fcb7340ce7168313ce393d663740b791c36f6e95fc8586:v1.7.4
        wipe: true
    files:
        - content: |-
            [plugins."io.containerd.grpc.v1.cri"]
              enable_unprivileged_ports = true
              enable_unprivileged_icmp = true
            [plugins."io.containerd.grpc.v1.cri".containerd]
              discard_unpacked_layers = false
            [plugins."io.containerd.grpc.v1.cri".containerd.runtimes.runc]
              discard_unpacked_layers = false
          permissions: 0
          path: /etc/cri/conf.d/20-customization.part
          op: create
        - content: |-
            [ NFSMount_Global_Options ]
            nfsvers=4.2
            hard=True
            noatime=True
            nodiratime=True
            rsize=131072
            wsize=131072
            nconnect=8
          permissions: 420
          path: /etc/nfsmount.conf
          op: overwrite
    sysctls:
        fs.inotify.max_queued_events: "65536"
        fs.inotify.max_user_instances: "8192"
        fs.inotify.max_user_watches: "524288"
        net.core.rmem_max: "2500000"
        net.core.wmem_max: "2500000"
    features:
        rbac: true
        stableHostname: true
        apidCheckExtKeyUsage: true
        diskQuotaSupport: true
        kubePrism:
            enabled: true
            port: 7445
            # hostDNS:
            #     enabled: true
    nodeLabels:
        bgp-peering-policy: pfSense
cluster:
    id: ENC[AES256_GCM,data:irpQ/Ux4Kf3f1cOfQaYkVyZOe/gBhPyo/mX0Qs5CgAFYYfmbwaQho4lzO9A=,iv:KsZ0L6tAksvQd9E7IWjCatwJ7vWgxAe1BzXCyJabYk8=,tag:0hB5xITmZffk0XK5O1KSEg==,type:str]
    secret: ENC[AES256_GCM,data:cFNMnBjaguqtZGiJBWbF9zpFiiH5yIDagehWvIntefR6+b7Q6qIX2Jt7qGo=,iv:+z1OPFvd4qgRArBCkQiuNxskHUmGXYL8jBeiHXvCeho=,tag:GzqiF/19gjW8oOLh4ky2IA==,type:str]
    controlPlane:
        endpoint: https://10.10.99.99:6443
    # clusterName: artemis-cluster
    network:
        cni:
            name: none
        dnsDomain: cluster.local
        podSubnets:
            - 10.42.0.0/16
        serviceSubnets:
            - 10.43.0.0/16
    coreDNS:
        disabled: true
    token: ENC[AES256_GCM,data:eHYiIFbWRcAiLLDJALq8uWrQABd2U2Y=,iv:9yE0ql0GiicfA49JRnFCv1txg3fqiyYKD7b2n9/9HGQ=,tag:qCbiKsYUaHwL4D3V4d4Zbw==,type:str]
    ca:
        crt: ENC[AES256_GCM,data:2y87/QWt9bCBHv4RSC3/rIkFz/5QF49WnhPr9NbXPlkvYkJjlqOPERtUzvRhV+9K5lKC/RoQojfZ87dxlweq1aSBvlMRH1UPzDG+yCRRWRGHb1Tzw0kOnZOdp3bgpGIZtd1JiWUlj8OrUhPCJYAkJUSMu8i7gzRc0Nhqo2r/GAbiWs4dBcEIvd7YHCuNjlRf7Xq0dJeLDAVivQ7+S1RrWOBjBoVHDq3Wxt/xNZkKVX67exSAPWbC+jdIx/L9IEolF0EmPwyuc6BZWmJ4kgdNM3+BY0nl6x0gQzskNYjjoAXV3IZlC6NqrPBFyE/VKzlOJR2oHfLM7JfQecvToWR4p2c2TGWpFHz07RX4v5uSZAvxi4gdBHEleTKTG2nkMm3Mkl6VQRMEuvnFQ+cysk0iFVElhKroIpLWnSXywTs0B8Ul/AtVGyPl6MBUqOq1i/ZxLHODC3lHT6CW5ehVU1CbI/qSvMOHs0YIKGQFZ0lb6QVS61IdwBgLBhKoiR6fj8RLvVAyQGHKFqwtHqySIYvD33azlXRbVDM6M87pWGUfcjzMrQ6Zxg9p9ZBH8Azp3+lf4i+PEwm1LEtPfD5WvSCzsOUq0tj5qtDZqGDKLiCgU8wj3XesnJa+lWxYFyKMPgrFRotwOWbnJibRBIWSRovwYnV3Bh2LvXpNEzpWX7ed9sM6cIsXJlbefgH6TH5gH2gJgzSaaTjrZKalkTVQpFrJK7h50JKhHr6R/qvUZDGZrLB5rKJJ11WHRZCtug8p6h+xj8At/rnW9f8vzzwRz/nEUwsASDJNKbfHOkV+gtXEuTHB/lkyTCWVfjHl+ZrnXXaV0PJFfnaVuCWC/sKCaRCB80LH4ZWl327ERzIhBe0qhug3TT06aZj92laBBFGf8q1fsTLYTAdSe6JQXKFUwTW6ETj8ctjKXJLzpPw5sFI0Hgohh/QX6IGSvc3eE5EZqTkYxGeFPcUODTKFz3KfznkabXmVxTJ1WpXWojKcWIh+twE7g62wIhO2JsMWq1PYF6kO6T7xqfwUGdYcJPAFjMU+YdKKFUU=,iv:BwcKm8YMafOCUsfa4JGXLIk7eB1BRiMR+xo44Vwm85I=,tag:MQL2XTIpVgyCJYbT67ewog==,type:str]
        key: ""
    discovery:
        enabled: true
        registries:
            kubernetes:
                disabled: false
            service:
                disabled: false
sops:
    kms: []
    gcp_kms: []
    azure_kv: []
    hc_vault: []
    age:
        - recipient: age1c0pswh5sdp70kxpanshda58ulx5zhyaat7gzqg597alw4la8d9us8ykqa3
          enc: |
            -----BEGIN AGE ENCRYPTED FILE-----
            YWdlLWVuY3J5cHRpb24ub3JnL3YxCi0+IFgyNTUxOSBGQkFjZjRKbVlVK1lCOWxJ
            cWlVTU9EcDUwWnBxSUs3VzFRaHZ6dEM2N3hnCm9pU1dwa3RDU29pQUpBMnFHYlZw
            UzhhWkJrVmFiMTdzNnpRWnFGQ1Zaam8KLS0tIEFZbFVrc0NuNDJldGtYTG9YL09i
            UFdmWk9JM1dKV3FnUDJVUWVRcWF6aFEKwLgnux6oFYCdAW9Ak9cttOG4/B7n6c0/
            dT5Xi4iqFklSeWHmoWTRwcxJugAFM4cXyMetwSfDqVk0LNl6jGAqCg==
            -----END AGE ENCRYPTED FILE-----
    lastmodified: "2024-06-19T06:23:11Z"
    mac: ENC[AES256_GCM,data:sD0BWMkO0vjmHCHKsVEF5iEmB1n7Jcw0Okqa11MpzH6zAxll3SQdgiPUoOYYciL9K5usByBx3PGLbRueLb4QPsYEfzKyW+VoidlV+YWTFHiggwXXldsLwKmGNAEmNYOauLXjPdrVa4OS7cgv2DJOvVA+YslBTyj7XQCZ6vVZqO0=,iv:pY2/dlVAIfQBOL/Y7uxns+rUpctvYgSMVHkvZEjxXx0=,tag:En9dckhcuYgbX+bf8EkFOQ==,type:str]
    pgp: []
    encrypted_regex: ^(token|crt|key|id|secret|secretboxEncryptionSecret|ca)$
    version: 3.8.1
