# yaml-language-server: $schema=https://www.talos.dev/v1.7/schemas/v1alpha1_config.schema.json
version: v1alpha1
debug: false
# persist: true
machine:
    type: worker
    token: ENC[AES256_GCM,data:HNTvKPUXNif7uNE16CvG1sRKFbOdeZA=,iv:2gOb+sE89K/ykajQ4rV0TVCs/MUgOlCDj8LpkGTeOSk=,tag:4pWX3IJJq596aSRGrMGbGQ==,type:str]
    ca:
        crt: ENC[AES256_GCM,data:Rcyhj9WAFyKIyHhmT9qs8r2jsViavdTPMasyC3sMsvXZe1OB3lRtHmw7S5rCOwTfy7pUay5fdF9aWUJbbhoaLu6ztByw6xDVOvzDHeGIIyM599LDjj3cjIATRwVgKc/faz9lw0hfKYYTUuxEFKI9ZerppVmouUUXcEcYgwxct03QXNE+aX5B9kXHopa5kEdadFUQ7WN7cvk8EtVs5YPZ/82CcYqpA2VpZg/LLFZh/EyatVUZxz0m6RY5XQLimL6ThSf27945nOu0h1r2sIQ2bEoNHQcGQuyHpHdybrDpbd80Puv7n1n+GJtklTEVtmpy2b8KTK3lg4aM558ZORq9VrwRpzhuSKC7W5PE+4nK2Za9sbFMlUV0FTJnKm+PSY6PyoIaSxdW5OZOe3s1M1FUcvvuuu/Ui4u8zmLkiJ3HwxEI9M1ueg+28HwSESaZcUXh0h0cd6K6kXhNcyyQ7LA8oMIJw3s3rSuAHI64NVRCbg9T1wHA/3mKGZVCODbQJ4jznlxagNx2R9vQdkuCBPvSTsyi8URcv9vClHcZQ0vzoXQ2f4LOVAvcxuyTWS8c8l+s8iTekHAFp+I/gABdvUbyJO/l9hltKUACp0HReHlzmCnQMwDbWWLlM20gnrAUwvycHTPsEW11NbkQX9wTiMlRzfpKKO7LxqoKxOXkk4RBLfI2bGcRZfLAce6cadO5Lbe3OotOeuXsnGRryIpgVrYWp+VGgZ8nk6Pp5z3ilw0XpzyCyLLNSl8Uu8mqAupr95r0K8qopxINzH8mjT3SnVLkG9VOd9tIIfBLgFvRdLAzdEv5z2DGV8QRMGkOPwFcIyb7m7M8NkFEg66Nk6a1Xif5mLibnZ/yGR0vyUjqfRbZ8gzYc9wk,iv:HqHbDCSzGwi5AWskyL4i0E7OBCG54wKqFPgdTLQNso4=,tag:CnXlghEBxKaUTdL3rGutwQ==,type:str]
        key: ""
    certSANs:
        - 127.0.0.1
        - 10.10.99.99
    kubelet:
        image: ghcr.io/siderolabs/kubelet:v1.30.0
        defaultRuntimeSeccompProfileEnabled: true
        disableManifestsDirectory: true
        extraMounts:
            - destination: /var/local/openebs
              type: bind
              source: /var/local/openebs
              options:
                - bind
                - rshared
                - rw
        nodeIP:
            validSubnets:
                - 10.10.99.0/24
    network:
        hostname: talos-w-02
        interfaces:
            - interface: eth0
              dhcp: true
    install:
        disk: /dev/sda
        extraKernelArgs:
            - mitigations=off
            - net.ifnames=0
            - -lockdown lockdown=integrity
            # systemExtensions:
            #     officialExtensions:
            #     - siderolabs/iscsi-tools
            #     - siderolabs/zfs
        image: factory.talos.dev/installer/dc7b152cb3ea99b821fcb7340ce7168313ce393d663740b791c36f6e95fc8586:v1.7.4
        wipe: true
    files:
        - content: |-
            [plugins."io.containerd.grpc.v1.cri"]
              enable_unprivileged_ports = true
              enable_unprivileged_icmp = true
            [plugins."io.containerd.grpc.v1.cri".containerd]
              discard_unpacked_layers = false
            [plugins."io.containerd.grpc.v1.cri".containerd.runtimes.runc]
              discard_unpacked_layers = false
          permissions: 0
          path: /etc/cri/conf.d/20-customization.part
          op: create
        - content: |-
            [ NFSMount_Global_Options ]
            nfsvers=4.2
            hard=True
            noatime=True
            nodiratime=True
            rsize=131072
            wsize=131072
            nconnect=8
          permissions: 420
          path: /etc/nfsmount.conf
          op: overwrite
    sysctls:
        fs.inotify.max_queued_events: "65536"
        fs.inotify.max_user_instances: "8192"
        fs.inotify.max_user_watches: "524288"
        net.core.rmem_max: "2500000"
        net.core.wmem_max: "2500000"
    features:
        rbac: true
        stableHostname: true
        apidCheckExtKeyUsage: true
        diskQuotaSupport: true
        kubePrism:
            enabled: true
            port: 7445
            # hostDNS:
            #     enabled: true
    nodeLabels:
        bgp-peering-policy: pfSense
cluster:
    id: ENC[AES256_GCM,data:JF6BbWjIcFcHv2zxZ/SjNlQqDDF6yZJXCXv+XWI7C6lsTgRpKBJZjHP9SEU=,iv:HNM8h0ttpqcsK/G9b0Lx5f9iLAgsXt23zK5jJ2xtSP0=,tag:jME1GlLqjWtvxXx8SmQa5w==,type:str]
    secret: ENC[AES256_GCM,data:AZ3OoSjRm1lAGI1MseBOfU3eowzL1fW1Yclx9wPztuXIu6ddXHZemV8RpTs=,iv:YqJE75QUFwM0krmSnuDrZ3i0EOusJNodA6SBaGyofsY=,tag:phnQHffYgEg4XrqEDmX3Xw==,type:str]
    controlPlane:
        endpoint: https://10.10.99.99:6443
    # clusterName: artemis-cluster
    network:
        cni:
            name: none
        dnsDomain: cluster.local
        podSubnets:
            - 10.42.0.0/16
        serviceSubnets:
            - 10.43.0.0/16
    coreDNS:
        disabled: true
    token: ENC[AES256_GCM,data:R3SG7fusvmuA1Z/mVuKF9Lg5tpK3G3Q=,iv:+nXySnbu0lhcLbqREemYFnYQvE9VTIdj7zNbo60Ozvo=,tag:CByTwUVENvwP7n+rw1Lh8w==,type:str]
    ca:
        crt: ENC[AES256_GCM,data:mrn1QulFtRqJhowfH/G0Ec15/GyCH5PhHBTDj7wRfLf7ioYNeY+FA1HTG1tSn08aWqhJF0VclwxLZIo9g0NCbHjrauW5FilRZU50LamlWsSb9MMSRM7oaVmk0NzijLmR3q2/Dw2/UhHeE/wpRdjrL0AZVOT0SeQWhXaNPlIjVCUsP6VKH6zwSQl3ThOBRJF3nAVDrdCqg8Mu1WoM0cy+d6NnKNY+PdPxb+a1CCuvl8+fh5i2CThErhAVmd856cxYpCmygPbL+ryKfP/vuDbqNvukKNjxy5EZ9dxgItL+ccZRkXD1eFM52p2slGQ8e8ibs/iZnl3cX2welxBnZUvB2QaJ8Dpxfq9Z0TjUOkClatqynH/uSjlrWvzPdFSv+6istdjm12yFQSLkfMPykW86kvZJv84aGtuiHtInrIvxOmSSdOozt7uYVwmIBXJsdDef1U/hf3T4aaIwXlmGH6C0sHtAhIFWkTRlsdvNqV+2etHhnxtukrMDpWksit01c2KSJ9rYzP/LPp5yKbXEDzqhrdbi6s6CXtc1Hd8OMcfPlGNjgJxqn+nkc96nodKZiAKGSlCO5payOc7KJ1L8adI3T+r8cJWlnno67gDIVYAS6SPjmnpbjsbmLDuEBLeUYc6No7h6H31/1ZP12xriPjLQXWmrjrkCNZjJowpOfcy182PCPSmtsCsDPk58gkIawG3rw9K/cy/XzA9OBX0Hr3f8s4iF6Cislb9PPmslSHhKM+LW0NAi12mzqf+EObUdNw96A7UQjodcXxas1LhlJUw6TNfBLvTNAsa5kspJvB5Kt8OuYLkZfsglF3oFwxN6o9/QM4Sy+7G5kda2kSgOuXZAfH5GC0zMLsfGzPP1T8BvMZcWc36qU7sPZJFTe1BkCs5CLH3z+F0I4QK6wVf8QttsI7h2mFdyjZqQc2Y63Mg+b3EXFyE2FQPu2j8FoszP/vjK3CLqzqiuXccPMZkDIRNM0Fmmgtdf/ihv4pfvvQ2uDVrZzd1y9UQsqsrUrG6ONGBlY83i1BpJEbrSVyAfzaLOGRTT0wQ=,iv:a5NI1L168rk3N0TE+C89vR+l4IpGethTfwHbK6Linlc=,tag:nzg/otK7PvDIhea1nU/Gjw==,type:str]
        key: ""
    discovery:
        enabled: true
        registries:
            kubernetes:
                disabled: false
            service:
                disabled: false
sops:
    kms: []
    gcp_kms: []
    azure_kv: []
    hc_vault: []
    age:
        - recipient: age1c0pswh5sdp70kxpanshda58ulx5zhyaat7gzqg597alw4la8d9us8ykqa3
          enc: |
            -----BEGIN AGE ENCRYPTED FILE-----
            YWdlLWVuY3J5cHRpb24ub3JnL3YxCi0+IFgyNTUxOSB6M2toM1NwYmFqK0FxaUxP
            bDMybFYvZjU1M3lrNlRIVGF1UFI3cHFVajN3CklxKzRVUS8waUJRdDBIeSs2eDZZ
            WnlSZlpjeGd5cWM0bmFFckQ0aEgrRWsKLS0tIFpTUWRteGowbi9nVnVVTnhOSm5Q
            QjhlL0xNdjdQT25CMjNIS0ZQY1RoMjAKzqxgcG4qDxaLsR9XQqMLsKQrx59wmSxh
            YqvzKy8gCpWf8TP2KbV9itAYENnVaLpa/TcC6Qh6+21CANy/QOPaKQ==
            -----END AGE ENCRYPTED FILE-----
    lastmodified: "2024-06-19T06:23:15Z"
    mac: ENC[AES256_GCM,data:MMbUZAKOqNhN3y5fUlWo0BQz8JZXpHze9j67ypkzp0JVS2/0fawSzF9NI+AyJR6QtgzYc4dhQZV7AQLREcQaQumTv1AbxZjrivjmb+lQGueaGjRlsqsUbRv3iwO0gbz5ejEsrj9fY51jo1qk5YKO2C/7+iX3cLEzBgj2tWQByNc=,iv:w+qmwVtfRV6XED8HNgT1lXTfHHz4+KosQMi0T3f0vP0=,tag:Lp2NMpEzvDhGz4xOxvGw9w==,type:str]
    pgp: []
    encrypted_regex: ^(token|crt|key|id|secret|secretboxEncryptionSecret|ca)$
    version: 3.8.1
