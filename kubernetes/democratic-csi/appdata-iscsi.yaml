apiVersion: helm.toolkit.fluxcd.io/v2beta1
kind: HelmRelease
metadata:
  name: appdata
  namespace: democratic-csi
spec:
  interval: 2m
  chart:
    spec:
      chart: democratic-csi
      version: 0.14.6
      sourceRef:
        kind: HelmRepository
        name: democratic-csi
        namespace: flux-system
      interval: 1m
  values:
    csiDriver:
      name: appdata
    controller:
      driver:
        logLevel: debug
        image: docker.io/democraticcsi/democratic-csi:v1.8.4
        # image: docker.io/democraticcsi/democratic-csi:v1.9.0
        imagePullPolicy: IfNotPresent
    driver:
      config:
        driver: freenas-api-iscsi
        # instance_id: null
        httpConnection:
          protocol: https
          host: 10.10.99.100
          port: 1443
          apiKey: 1-yK8VKRrSLbALwEdrJz1YdY2gzzVq4IEQyttToJQKTPXMoSzIlDxDvnQN062XMhn3
          allowInsecure: true
        zfs:
          datasetParentName: appdata/volumes
          detachedSnapshotsDatasetParentName: appdata/snapshots
          # zvolCompression: null
          # zvolDedup: null
          zvolEnableReservation: false
          # zvolBlocksize: null
        iscsi:
          targetPortal: 10.10.99.100:3260
          targetPortals: []
          interface: null
          namePrefix: csi-
          nameSuffix: -cluster
          targetGroups:
          - targetGroupPortalGroup: 2
            targetGroupInitiatorGroup: 3
            targetGroupAuthType: None
            # targetGroupAuthGroup: null
          extentInsecureTpc: true
          extentXenCompat: false
          extentDisablePhysicalBlocksize: true
          extentBlocksize: 512
          extentRpm: SSD
          extentAvailThreshold: 0
    node:
      driver:
        logLevel: debug
        image: docker.io/democraticcsi/democratic-csi:v1.8.4
        imagePullPolicy: IfNotPresent
    storageClasses:
    - name: appdata
      defaultClass: false
      reclaimPolicy: Delete
      volumeBindingMode: Immediate
      allowVolumeExpansion: true
      parameters:
        fsType: xfs
        detachedVolumesFromSnapshots: "false"
      mountOptions: []
      secrets:
        provisioner-secret:
        controller-publish-secret:
        node-stage-secret:
        node-publish-secret:
        controller-expand-secret:
