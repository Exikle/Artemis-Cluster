---
apiVersion: v1
kind: ConfigMap
metadata:
  name: gatus-configmap
  namespace: observability
data:
  config.yaml: |
    # Storage configuration
    storage:
      type: sqlite
      path: /config/data.db
      caching: true

    # Metrics for Prometheus
    metrics: true

    # Web server config
    web:
      port: 8080
      address: 0.0.0.0

    # UI customization
    ui:
      title: Artemis Cluster Status
      header: Artemis Cluster Health Dashboard
      description: "Real-time health monitoring for Artemis Cluster services"
      link: https://status.dcunha.io
      buttons:
        - name: Grafana
          link: https://grafana.dcunha.io
        - name: GitHub
          link: https://github.com/Exikle/Artemis-Cluster

    # Import endpoints from separate file
    endpoints:
      - group: external
        interval: 5m

  endpoints.yaml: |
    endpoints:
      # ======================================
      # External Services
      # ======================================
      - name: grafana
        group: external
        url: "https://grafana.dcunha.io"
        interval: 30s
        conditions:
          - "[STATUS] == 200"
          - "[RESPONSE_TIME] < 2000"

      - name: status-page
        group: external
        url: "https://status.dcunha.io"
        interval: 60s
        conditions:
          - "[STATUS] == 200"

      # ======================================
      # Observability Stack
      # ======================================
      - name: prometheus
        group: observability
        url: "http://kube-prometheus-stack-prometheus.observability.svc.cluster.local:9090/-/healthy"
        interval: 30s
        conditions:
          - "[STATUS] == 200"

      - name: alertmanager
        group: observability
        url: "http://kube-prometheus-stack-alertmanager.observability.svc.cluster.local:9093/-/healthy"
        interval: 30s
        conditions:
          - "[STATUS] == 200"

      - name: loki
        group: observability
        url: "http://loki-gateway.observability.svc.cluster.local/ready"
        interval: 30s
        conditions:
          - "[STATUS] == 200"

      - name: grafana-instance
        group: observability
        url: "http://grafana.observability.svc.cluster.local:3000/api/health"
        interval: 30s
        conditions:
          - "[STATUS] == 200"

      # ======================================
      # Infrastructure
      # ======================================
      - name: cilium
        group: infrastructure
        url: "http://hubble-relay.kube-system.svc.cluster.local:80/healthz"
        interval: 60s
        conditions:
          - "[STATUS] == 200"

      - name: external-dns
        group: infrastructure
        url: "http://external-dns.network.svc.cluster.local:7979/healthz"
        interval: 60s
        conditions:
          - "[STATUS] == 200"

      - name: cert-manager
        group: infrastructure
        url: "http://cert-manager.cert-manager.svc.cluster.local:9402/healthz"
        interval: 60s
        conditions:
          - "[STATUS] == 200"

      # ======================================
      # Storage
      # ======================================
      - name: rook-ceph
        group: storage
        url: "http://rook-ceph-mgr.rook-ceph.svc.cluster.local:9283/metrics"
        interval: 60s
        conditions:
          - "[STATUS] == 200"
