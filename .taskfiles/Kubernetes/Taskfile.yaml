---
version: "3"

tasks:
  nodes:
    desc: Show all Kubernetes nodes
    cmds:
      - kubectl get nodes -o wide

  pods:
    desc: Show all pods in all namespaces
    cmds:
      - kubectl get pods -A

  pods:failing:
    desc: Show failing/pending pods
    cmds:
      - kubectl get pods -A | grep -v Running | grep -v Completed

  events:
    desc: Show recent cluster events
    cmds:
      - kubectl get events -A --sort-by='.lastTimestamp' | tail -50

  namespaces:
    desc: List all namespaces
    cmds:
      - kubectl get namespaces

  top:nodes:
    desc: Show node resource usage
    cmds:
      - kubectl top nodes

  top:pods:
    desc: Show pod resource usage
    cmds:
      - kubectl top pods -A

  cilium:status:
    desc: Check Cilium status
    cmds:
      - kubectl exec -n kube-system ds/cilium -- cilium status

  cilium:bgp:
    desc: Check Cilium BGP peers
    cmds:
      - kubectl exec -n kube-system ds/cilium -- cilium bgp peers

  cilium:connectivity:
    desc: Run Cilium connectivity test
    cmds:
      - kubectl exec -n kube-system ds/cilium -- cilium connectivity test

  gateway:list:
    desc: List all Gateways
    cmds:
      - kubectl get gateway -A

  gateway:routes:
    desc: List all HTTPRoutes
    cmds:
      - kubectl get httproute -A

  gateway:status:
    desc: Show Gateway status details
    cmds:
      - kubectl describe gateway external-gateway -n default

  debug:pod:
    desc: Start debug pod with netshoot
    cmds:
      - kubectl run -it --rm debug --image=nicolaka/netshoot --restart=Never -- bash

  debug:dns:
    desc: Test DNS resolution
    cmds:
      - kubectl run -it --rm debug --image=busybox --restart=Never -- nslookup kubernetes.default.svc.cluster.local

  health:
    desc: Run cluster health check script
    cmds:
      - bash scripts/health-check.sh
