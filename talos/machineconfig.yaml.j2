---
machine:
  install:
    extraKernelArgs:
      - net.ifnames=0
  features:
    kubePrism:
      enabled: true
      port: 7445
  kubelet:
    defaultRuntimeSeccompProfileEnabled: true
    disableManifestsDirectory: true
    image: ghcr.io/siderolabs/kubelet:v1.34.1
    extraMounts:
      - destination: /var/local/openebs
        type: bind
        source: /var/local/openebs
        options:
          - bind
          - rshared
          - rw
  time:
    disabled: false
    servers:
      - time.cloudflare.com
  network:
    interfaces:
      - interface: eth0
        dhcp: false
      - interface: br0
        dhcp: false
        bridge:
          interfaces:
            - eth0
        vlans:
          - vlanId: 1099
            dhcp: false
          - vlanId: 1152
            dhcp: false
  files:
    - op: create
      path: /etc/cri/conf.d/20-customization.part
      content: |
        [plugins]
          [plugins."io.containerd.grpc.v1.cri"]
            enable_unprivileged_ports = true
            enable_unprivileged_icmp = true
    - op: overwrite
      path: /etc/nfsmount.conf
      permissions: 0o644
      content: |
        [ NFSMount_Global_Options ]
        nfsvers=4.2
        hard=True
        noatime=True
  sysctls:
    fs.inotify.max_user_instances: "8192"
    fs.inotify.max_user_watches: "1048576"
    net.core.somaxconn: "65535"
    net.core.netdev_max_backlog: "30000"
    net.core.rmem_max: "67108864"
    net.core.wmem_max: "67108864"
    net.ipv6.conf.all.disable_ipv6: "1"
    net.ipv6.conf.default.disable_ipv6: "1"
